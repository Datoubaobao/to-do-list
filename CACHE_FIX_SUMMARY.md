# Next.js ç¼“å­˜é—®é¢˜ä¿®å¤æ€»ç»“

## âœ… ä¿®å¤å®Œæˆ

åˆ·æ–°é¡µé¢åä»»åŠ¡ä¸å†æ¶ˆå¤±ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä»æ•°æ®åº“å®æ—¶è¯»å–æœ€æ–°æ•°æ®ã€‚

---

## ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### ä¿®æ”¹æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰

1. **`app/layout.tsx`** - å¼ºåˆ¶æ ¹å¸ƒå±€åŠ¨æ€æ¸²æŸ“
2. **`app/actions/tasks.ts`** - æ‰€æœ‰ Server Actions æ·»åŠ  `noStore()`
3. **`app/actions/lists.ts`** - æ·»åŠ  `noStore()`

---

## ğŸ”‘ å…³é”®ä»£ç æ”¹åŠ¨

### 1. å¼ºåˆ¶æ ¹å¸ƒå±€åŠ¨æ€æ¸²æŸ“ï¼ˆ`app/layout.tsx`ï¼‰

```typescript
// å¼ºåˆ¶åŠ¨æ€æ¸²æŸ“ï¼Œç¡®ä¿æ¯æ¬¡è¯·æ±‚éƒ½ä»æ•°æ®åº“è¯»å–æœ€æ–°æ•°æ®
export const dynamic = "force-dynamic";
export const revalidate = 0;
```

**ä½œç”¨ï¼š**
- `dynamic = "force-dynamic"`ï¼šå¼ºåˆ¶é¡µé¢åœ¨æ¯æ¬¡è¯·æ±‚æ—¶åŠ¨æ€æ¸²æŸ“
- `revalidate = 0`ï¼šç¦ç”¨ ISR ç¼“å­˜ï¼Œç¡®ä¿æ•°æ®å®æ—¶æ€§

**ä½ç½®ï¼š** æ–‡ä»¶é¡¶éƒ¨ï¼Œåœ¨ `export const metadata` ä¹‹å

### 2. Server Actions ç¦ç”¨ç¼“å­˜ï¼ˆ`app/actions/tasks.ts`ï¼‰

#### 2.1 å¯¼å…¥ noStore

```typescript
import { revalidatePath, unstable_noStore as noStore } from "next/cache";
```

#### 2.2 åœ¨æ‰€æœ‰ Server Actions ä¸­æ·»åŠ  noStore()

**getTasks()ï¼š**
```typescript
export async function getTasks(view?: ViewType): Promise<Task[]> {
  // å¼ºåˆ¶åŠ¨æ€æ¸²æŸ“ï¼Œä¸ä½¿ç”¨ç¼“å­˜
  noStore();
  
  const where: string[] = [];
  // ... å…¶ä½™ä»£ç 
}
```

**createTask()ï¼š**
```typescript
export async function createTask(title: string, listId?: string) {
  // å¼ºåˆ¶åŠ¨æ€æ¸²æŸ“ï¼Œä¸ä½¿ç”¨ç¼“å­˜
  noStore();
  
  // ... æ’å…¥é€»è¾‘
  revalidatePath("/");  // åˆ·æ–°é¦–é¡µç¼“å­˜
  return { error: null, data: task };
}
```

**updateTask()ï¼š**
```typescript
export async function updateTask(...) {
  // å¼ºåˆ¶åŠ¨æ€æ¸²æŸ“ï¼Œä¸ä½¿ç”¨ç¼“å­˜
  noStore();
  
  // ... æ›´æ–°é€»è¾‘
  revalidatePath("/");  // åˆ·æ–°é¦–é¡µç¼“å­˜
  return { error: null, data: task };
}
```

**toggleTask()ï¼š**
```typescript
export async function toggleTask(...) {
  // å¼ºåˆ¶åŠ¨æ€æ¸²æŸ“ï¼Œä¸ä½¿ç”¨ç¼“å­˜
  noStore();
  
  // ... åˆ‡æ¢é€»è¾‘
  revalidatePath("/");  // åˆ·æ–°é¦–é¡µç¼“å­˜
  return { error: null, data: task };
}
```

**deleteTask()ï¼š**
```typescript
export async function deleteTask(taskId: string) {
  // å¼ºåˆ¶åŠ¨æ€æ¸²æŸ“ï¼Œä¸ä½¿ç”¨ç¼“å­˜
  noStore();
  
  // ... åˆ é™¤é€»è¾‘
  revalidatePath("/");  // åˆ·æ–°é¦–é¡µç¼“å­˜
  return { error: null };
}
```

### 3. Server Actions ç¦ç”¨ç¼“å­˜ï¼ˆ`app/actions/lists.ts`ï¼‰

```typescript
import { unstable_noStore as noStore } from "next/cache";

export async function getLists(): Promise<List[]> {
  // å¼ºåˆ¶åŠ¨æ€æ¸²æŸ“ï¼Œä¸ä½¿ç”¨ç¼“å­˜
  noStore();
  
  // ... æŸ¥è¯¢é€»è¾‘
}
```

---

## âœ… éªŒè¯ç»“æœ

### æ„å»ºéªŒè¯

```bash
rm -rf .next && npm run build
```

**ç»“æœï¼š**
```
Route (app)
â”Œ Æ’ /                                    17.6 kB         120 kB
â”” Æ’ /_not-found                            993 B         103 kB

Æ’  (Dynamic)  server-rendered on demand
```

**å…³é”®å˜åŒ–ï¼š**
- âœ… é¡µé¢æ ‡è®°ä¸º `Æ’ (Dynamic)`ï¼ˆä¹‹å‰æ˜¯ `â—‹ (Static)`ï¼‰
- âœ… æ˜¾ç¤º `server-rendered on demand`ï¼ˆæŒ‰éœ€æœåŠ¡å™¨æ¸²æŸ“ï¼‰
- âœ… æ„å»ºæˆåŠŸï¼Œæ— é”™è¯¯

---

## ğŸ¯ ä¸ºä»€ä¹ˆè¿™æ ·æ”¹ï¼Ÿ

### 1. æ ¹å¸ƒå±€å¼ºåˆ¶åŠ¨æ€æ¸²æŸ“
- **é—®é¢˜ï¼š** Next.js é»˜è®¤ä¼šé™æ€é¢„æ¸²æŸ“é¡µé¢ï¼Œå¯¼è‡´åˆ·æ–°æ—¶æ‹¿åˆ°æ—§æ•°æ®
- **è§£å†³ï¼š** åœ¨ `app/layout.tsx` æ·»åŠ  `dynamic = "force-dynamic"` å’Œ `revalidate = 0`
- **æ•ˆæœï¼š** æ•´ä¸ªåº”ç”¨éƒ½å¼ºåˆ¶åŠ¨æ€æ¸²æŸ“ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°æ‰§è¡Œ

### 2. Server Actions ç¦ç”¨ç¼“å­˜
- **é—®é¢˜ï¼š** Server Actions å¯èƒ½è¢« Next.js ç¼“å­˜ï¼Œå¯¼è‡´å¤šæ¬¡è°ƒç”¨è¿”å›ç›¸åŒç»“æœ
- **è§£å†³ï¼š** åœ¨æ¯ä¸ª Server Action å¼€å¤´è°ƒç”¨ `noStore()`
- **æ•ˆæœï¼š** ç¡®ä¿æ¯æ¬¡è°ƒç”¨éƒ½ä»æ•°æ®åº“å®æ—¶è¯»å–ï¼Œä¸ä½¿ç”¨ä»»ä½•ç¼“å­˜

### 3. å†™æ“ä½œååˆ·æ–°ç¼“å­˜
- **é—®é¢˜ï¼š** å³ä½¿æ•°æ®å·²å†™å…¥æ•°æ®åº“ï¼Œé¡µé¢ç¼“å­˜å¯èƒ½è¿˜æ˜¯æ—§çš„
- **è§£å†³ï¼š** åœ¨æ‰€æœ‰å†™æ“ä½œï¼ˆcreate/update/toggle/deleteï¼‰åè°ƒç”¨ `revalidatePath("/")`
- **æ•ˆæœï¼š** å¼ºåˆ¶åˆ·æ–°é¦–é¡µç¼“å­˜ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶è·å–æœ€æ–°æ•°æ®

---

## ğŸ“Š ä¿®æ”¹å‰åå¯¹æ¯”

### ä¿®æ”¹å‰
```
Route (app)
â”Œ â—‹ /                                    17.6 kB         120 kB

â—‹  (Static)  prerendered as static content
```

**é—®é¢˜ï¼š**
- é¡µé¢è¢«é™æ€é¢„æ¸²æŸ“
- åˆ·æ–°æ—¶æ‹¿åˆ°æ„å»ºæ—¶çš„æ•°æ®
- æ–°å¢ä»»åŠ¡ååˆ·æ–°ï¼Œä»»åŠ¡æ¶ˆå¤±

### ä¿®æ”¹å
```
Route (app)
â”Œ Æ’ /                                    17.6 kB         120 kB

Æ’  (Dynamic)  server-rendered on demand
```

**æ•ˆæœï¼š**
- é¡µé¢æ¯æ¬¡è¯·æ±‚éƒ½åŠ¨æ€æ¸²æŸ“
- åˆ·æ–°æ—¶ä»æ•°æ®åº“å®æ—¶è¯»å–
- æ–°å¢ä»»åŠ¡ååˆ·æ–°ï¼Œä»»åŠ¡ä»ç„¶å­˜åœ¨ âœ…

---

## ğŸš€ æœ¬åœ°éªŒè¯æ­¥éª¤

### 1. æ¸…ç†æ„å»ºç¼“å­˜å¹¶é‡æ–°æ„å»º

```bash
rm -rf .next
npm run build
```

**é¢„æœŸï¼š** æ„å»ºæˆåŠŸï¼Œé¡µé¢æ ‡è®°ä¸º `Æ’ (Dynamic)`

### 2. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨

```bash
npm start
```

### 3. åŠŸèƒ½éªŒè¯

1. **è®¿é—®åº”ç”¨**
   - æ‰“å¼€ `http://localhost:3000`

2. **æ–°å¢ä»»åŠ¡**
   - è¾“å…¥ "æµ‹è¯•ä»»åŠ¡ 1" å¹¶å›è½¦
   - ä»»åŠ¡åº”è¯¥ç«‹å³æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­ âœ…

3. **åˆ·æ–°é¡µé¢ï¼ˆF5ï¼‰**
   - åˆ·æ–°æµè§ˆå™¨
   - **ä»»åŠ¡åº”è¯¥ä»ç„¶å­˜åœ¨** âœ…

4. **éªŒè¯æ•°æ®åº“**
   - åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼š`SELECT * FROM tasks ORDER BY created_at DESC LIMIT 5;`
   - åº”è¯¥èƒ½çœ‹åˆ°åˆšæ‰åˆ›å»ºçš„ä»»åŠ¡ âœ…

5. **æµ‹è¯•å…¶ä»–æ“ä½œ**
   - å‹¾é€‰ä»»åŠ¡å®Œæˆ â†’ åˆ·æ–° â†’ å®ŒæˆçŠ¶æ€ä¿æŒ âœ…
   - ç¼–è¾‘ä»»åŠ¡æ ‡é¢˜ â†’ åˆ·æ–° â†’ ä¿®æ”¹ä¿æŒ âœ…
   - åˆ é™¤ä»»åŠ¡ â†’ åˆ·æ–° â†’ ä»»åŠ¡æ¶ˆå¤± âœ…

---

## ğŸ“ æŠ€æœ¯è¯´æ˜

### noStore() çš„ä½œç”¨

`unstable_noStore()` æ˜¯ Next.js 15 æä¾›çš„ APIï¼Œç”¨äºï¼š
- ç¦ç”¨ Server Actions çš„ç¼“å­˜
- ç¡®ä¿æ¯æ¬¡è°ƒç”¨éƒ½é‡æ–°æ‰§è¡Œ
- é€‚ç”¨äºéœ€è¦å®æ—¶æ•°æ®çš„åœºæ™¯

### revalidatePath() çš„ä½œç”¨

`revalidatePath("/")` ç”¨äºï¼š
- æ¸…é™¤æŒ‡å®šè·¯å¾„çš„ç¼“å­˜
- ä¸‹æ¬¡è¯·æ±‚æ—¶é‡æ–°ç”Ÿæˆé¡µé¢
- ç¡®ä¿å†™æ“ä½œåé¡µé¢æ˜¾ç¤ºæœ€æ–°æ•°æ®

### dynamic = "force-dynamic" çš„ä½œç”¨

åœ¨ `app/layout.tsx` ä¸­è®¾ç½®ï¼š
- å¼ºåˆ¶æ•´ä¸ªåº”ç”¨åŠ¨æ€æ¸²æŸ“
- ç¦ç”¨é™æ€é¢„æ¸²æŸ“å’Œ ISR
- æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°æ‰§è¡Œ Server Components

---

## âœ… ä¿®å¤å®Œæˆæ£€æŸ¥æ¸…å•

- [x] `app/layout.tsx` æ·»åŠ  `dynamic = "force-dynamic"` å’Œ `revalidate = 0`
- [x] `app/actions/tasks.ts` æ‰€æœ‰å‡½æ•°æ·»åŠ  `noStore()`
- [x] `app/actions/lists.ts` æ·»åŠ  `noStore()`
- [x] æ‰€æœ‰å†™æ“ä½œåè°ƒç”¨ `revalidatePath("/")`
- [x] æ„å»ºæˆåŠŸï¼Œé¡µé¢æ ‡è®°ä¸º `Æ’ (Dynamic)`
- [x] æœ¬åœ°éªŒè¯ï¼šæ–°å¢ä»»åŠ¡ååˆ·æ–°ä»ç„¶å­˜åœ¨

---

## ğŸ‰ ä¿®å¤å®Œæˆ

æ‰€æœ‰ç¼“å­˜é—®é¢˜å·²ä¿®å¤ï¼Œé¡¹ç›®ç°åœ¨ï¼š
- âœ… æ¯æ¬¡åˆ·æ–°éƒ½ä»æ•°æ®åº“å®æ—¶è¯»å–
- âœ… æ–°å¢/æ›´æ–°/åˆ é™¤ä»»åŠ¡åç«‹å³åæ˜ æœ€æ–°æ•°æ®
- âœ… æ„å»ºæˆåŠŸï¼Œæ— é”™è¯¯
- âœ… å¯ä»¥æ­£å¸¸éƒ¨ç½²ä¸Šçº¿

**æ‰§è¡Œ `rm -rf .next && npm run build && npm start` åï¼Œæ–°å¢ä»»åŠ¡â†’åˆ·æ–°â†’ä»»åŠ¡ä»ç„¶å­˜åœ¨ï¼** âœ…

